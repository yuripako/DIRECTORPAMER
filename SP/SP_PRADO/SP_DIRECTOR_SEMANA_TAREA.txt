CREATE DEFINER=`developer2021`@`%` PROCEDURE `SP_DIRECTOR_SEMANA_TAREA`(
_codciclo INT,
_codlinea INT
)
BEGIN


SELECT 
TBL1.datos,
GROUP_CONCAT( DISTINCT TBL2.semana SEPARATOR ' | ' ) semana

FROM(
SELECT a.codtutor,b.nomsalones,
CONCAT(a.apellidos," ",a.nombres) datos, c.codlinea
FROM tutores a
INNER JOIN salones b on a.codtutor =b.codtutor
INNER JOIN ccostos c on c.codccostos= b.codccosto
WHERE b.codciclo=_codciclo  AND c.codlinea=_codlinea
AND c.codlinea NOT IN (32)
GROUP BY 1) TBL1
INNER JOIN 
(
SELECT
	b.nombre_curso,
	 a.idsemana semana	,
	 CONCAT("CORRECTAS : ",a.buenas,"   INCORRECTAS : ",a.malas," EN BLANCO : ",a.blanco)  as det,
	SUM(a.buenas) A,
	SUM(a.malas) B,
	SUM(a.blanco) C,
	b.linea
FROM distancia_notas_tareas a
INNER JOIN distancia_cursos b ON a.codcurso = b.id
WHERE b.linea=_codlinea
GROUP BY 1
) TBL2 ON TBL1.codlinea = TBL2.linea
-- WHERE TBL2.semana=_semana
GROUP BY 1;


END